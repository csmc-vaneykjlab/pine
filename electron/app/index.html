<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>PINE</title>
    <link href="./css/index.css" rel="stylesheet" type="text/css" />
    <link href="./css/fontawesome-free-5.11.2-web/css/all.min.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="app">
      <div class="overlay" v-show="show_about">
        <div class="box-children-center-center">
          <div class="about-box">
            <h4>PINE - Protein Interaction Network Extractor</h4>
            <p>Developed at Cedars-Sinai</p>
            <hr/>
            <div>
              <span class="button" v-on:click="() => show_about = false">Close</span>
            </div>
          </div>
        </div>
      </div>

      <ul class="tab-selector">
        <li v-on:click="switchTab(tabs.INPUT)" v-bind:class="{'disabled': !tabReachable(tabs.INPUT), 'active': current_tab === tabs.INPUT}">Settings</li>
        <li v-on:click="switchTab(tabs.PROGRESS)" v-bind:class="{'disabled': !tabReachable(tabs.PROGRESS), 'active': current_tab === tabs.PROGRESS}">Log</li>
        <li v-on:click="switchTab(tabs.PATHWAY_SELECTION)" v-bind:class="{'disabled': !tabReachable(tabs.PATHWAY_SELECTION), 'active': current_tab === tabs.PATHWAY_SELECTION}">Pathway Selection</li>
      </ul>

      <div class="full-section">

        <div v-if="current_tab === tabs.PATH_LOCATION">
          <section class="full-section">
            Enter the full path of the Cytoscape executable:
            <label class="button success-button" for="file-button-cytoscape">Select file</label>
            <input class="file-button" id="file-button-cytoscape" v-on:change="inputFileChange($event, 'cytoscape_path')" type="file" />
            {{ input.cytoscape_path }}
          </section>
          <section class="full-section">
            Enter the full path of the ClueGO files:
            <label class="button success-button" for="file-button-cluego">Select file</label>
            <input class="file-button" id="file-button-cluego" v-on:change="inputFileChange($event, 'cluego_base_path')" type="file" />
            {{ input.cluego_base_path }}
          </section>
        </div>

        <div v-if="current_tab === tabs.INPUT">

          <h4 class="full-section-header">
            <div class="grid-2-columns">
              <div>
                Configuration
                <span style="cursor: pointer" v-on:click="() => show_config = !show_config" v-show="!show_config"><i class="fas fa-plus-circle"></i></span>
                <span style="cursor: pointer" v-on:click="() => show_config = !show_config" v-show="show_config"><i class="fas fa-minus-circle"></i></span>
                <span class="small-info">{{ configuration_message }}</span>
              </div>
              <div class="box-children-right">
                <span class="button" v-on:click="() => show_about = true"><i class="fas fa-info"></i></span>
              </div>
            </div>
          </h4>
          <div class="full-section" v-show="show_config">

            <div class="grid-config-options">
              <div class="align-right">Cytoscape path</div>
              <div>
                <label class="button success-button" for="file-button-cytoscape">Select file</label>
                <input class="file-button" id="file-button-cytoscape" v-on:change="inputFileChange($event, 'cytoscape_path')" type="file" />
              </div>
              <div>{{ input.cytoscape_path }}</div>

              <div class="align-right">ClueGO directory</div>
              <div>
                <label class="button success-button" for="file-button-cluego">Select file</label>
                <input class="file-button" id="file-button-cluego" v-on:change="inputFileChange($event, 'cluego_base_path')" type="file" />
              </div>
              <div>
                {{ input.cluego_base_path }}
                <select v-model="cluego_picked_version">
                  <option v-for="cv in cluego_versions" v-bind:value="cv">
                    {{ cv.version }}
                    {{ cv.latest ? "(latest)" : "" }}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div class="vertical-sep-small"></div>

          <h4 class="full-section-header">Required options</h4>
          <div class="full-section">
            <div class="grid-options">

              <div class="align-right">
                <span class="tooltip-parent">
                  Input file <i class="far fa-question-circle"></i>
                  <div class="tooltip">Input file in CSV format</div>
                </span>
              </div>
              <div>
                <label class="button success-button" for="file-button-input">Select file</label>
                <input class="file-button" id="file-button-input" v-on:change="inputFileChange($event, 'in')" type="file" />
                <span class="text-small" v-show="input.in">{{ input.in | filename }}</span>
              </div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Species <i class="far fa-question-circle"></i>
                  <div class="tooltip">We currently only support mouse, human and rat.  Mouse and human are supported by default in ClueGO but rat needs to be downloaded manually.</div>
                </span>
              </div>
              <div>
                <select v-model="input.species" v-if="cluego_picked_version">
                  <option v-for="mapping in cluego_picked_version.mapping_files" v-bind:value="species_map[mapping.species.toLowerCase()]">{{ species_map[mapping.species.toLowerCase()] }}</option>
                </select>
              </div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Output directory <i class="far fa-question-circle"></i>
                  <div class="tooltip">The directory where your files will be saved.</div>
                </span>
              </div>
              <div>
                <label class="button success-button" for="file-button-output">Select directory</label>
                <input class="file-button" id="file-button-output" type="file" v-on:change="inputFileChange($event, 'output')" webkitdirectory />
                <span class="text-small" v-show="input.output">{{ input.output | filename }}</span>
              </div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Type <i class="far fa-question-circle"></i>
                  <div class="tooltip">Input type</div>
                </span>
              </div>
              <div>
                <select v-model="input.type">
                  <option v-for="(val, key) in allowed_types" v-bind:value="key">{{ val.text }}</option>
                </select>
              </div>

              <div v-if="is_extra_options_required()" class="align-right">
                <span class="tooltip-parent">
                  Fasta file <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div v-if="is_extra_options_required()">
                <label class="button success-button" for="file-button-output">Select file</label>
                <input class="file-button" id="file-button-output" type="file" v-on:change="inputFileChange($event, 'fasta_file')" />
                <span class="text-small" v-show="input.fasta_file">{{ input.fasta_file | filename }}</span>
              </div>

              <div v-if="is_extra_options_required()"></div>

              <div class="align-right" v-if="is_extra_options_required()">
                <span class="tooltip-parent">
                  Enzyme <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div v-if="is_extra_options_required()">
                <select v-model="input.enzyme">
                  <option v-for="(val, key) in allowed_enzymes" v-bind:value="key">{{ val }}</option>
                </select>
              </div>

              <div v-if="is_extra_options_required()"></div>
              <div v-if="is_extra_options_required()"></div>
              <div v-if="is_extra_options_required()"></div>

              <div class="align-right" v-if="is_extra_options_required()">
                <span class="tooltip-parent">
                  Modifications <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div v-if="is_extra_options_required()">
                <input type="text" v-model="input.mods" />
              </div>

            </div>
          </div>

          <h4 class="full-section-header">Additional options</h4>
          <div class="full-section">

            <div class="grid-options">

              <div class="align-right">
                <span class="tooltip-parent">
                  Reference file <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div>
                <label class="button success-button" for="file-button-reference">Select file</label>
                <input class="file-button" id="file-button-reference" type="file" v-on:change="inputFileChange($event, 'reference_path')" />
                <div class="text-small" v-show="input.reference_path" style="margin-top: 0.5rem" v-bind:title="input.reference_path">{{ input.reference_path | filename }}</div>
              </div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Confidence score <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div><input v-model="input.score" type="number" step="0.01" min="0.0" max="1.0" /></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  ClueGO grouping <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div>
                <select v-model="input.grouping">
                  <option v-for="acg in allowed_grouping" v-bind:value="acg">{{ acg }}</option>
                </select>
              </div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  ClueGo p-value <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div><input type="number" step="0.01" min="0.0" max="1.0" v-model="input.cluego_pval" /></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  # of interactors <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div><input type="number" step="1" min="0" max="100" v-model="input.limit" /></div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Fold change cutoff <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div><input type="number" step="0.01" min="0" v-model="input.fccutoff" /></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  P-value cutoff <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div><input type="number" step="0.01" min="0" max="1" v-model="input.pvalcutoff" /></div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Outline significant <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div><input type="checkbox" v-model="input.significant" /></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Run <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div>
                <select v-model="input.run">
                  <option v-for="ar in allowed_runs" v-bind:value="ar">{{ ar }}</option>
                </select>
              </div>

              <div></div>

              <div class="align-right">
                <span class="tooltip-parent">
                  Visualize <i class="far fa-question-circle"></i>
                  <div class="tooltip"></div>
                </span>
              </div>
              <div>
                <select v-model="input.visualize">
                  <option v-for="av in allowed_visualize" v-bind:value="av">{{ av }}</option>
                </select>
              </div>

              <div></div>
              <div></div>

            </div>
          </div>


          <section class="run-section">
            <span class="button success-button big" v-bind:class="{'disabled': !runnable()}" v-on:click="run_full()">Start</span>
            <span class="horizontal-sep"></span>
            <span class="button success-button big">Reset</span>
          </section>
        </div>

        <div v-if="current_tab === tabs.PROGRESS">
          <div v-show="stderr" class="full-section">
            <div class="log-stderr">{{ stderr }}</div>
          </div>
          <div class="full-section">
            <div class="log-stdout">{{ stdout }}</div>
          </div>
        </div>

        <div v-if="current_tab === tabs.PATHWAY_SELECTION">
          <div class="full-section">
            <h4>Pathway selection</h4>
            <p>Choose a subset of pathways to analyze.</p>
            <div>
              Filter: <input type="text" v-model="cluego_pathways.query" />
            </div>
            <div class="vertical-sep"></div>
            <div class="scroll-table-wrapper">
              <table class="pathway-picker">
                <thead>
                  <tr>
                    <th></th>
                    <th>GO term</th>
                    <th>Ontology</th>
                    <th>P-value</th>
                    <th>Adj. p-value</th>
                    <th>% genes</th>
                    <th># of genes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="pathway in cluego_pathways_filtered.data">
                    <td><input type="checkbox" v-model="pathway.selected" /></td>
                    <td>{{ pathway.data['GOTerm'] }}</td>
                    <td>{{ pathway.data['Ontology Source'] }}</td>
                    <td class="align-right">{{ pathway.data['Term PValue'] | roundString(4) }}</td>
                    <td class="align-right">{{ pathway.data['Term PValue Corrected with Bonferroni step down'] | roundString(4) }}</td>
                    <td class="align-right">{{ pathway.data['% Associated Genes'] | roundString(2) }}%</td>
                    <td class="align-right">{{ pathway.data['Nr. Genes'] }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="vertical-sep"></div>
            <div class="grid-2-columns">
              <div>
                <div>
                  <div class="button" v-bind:class="{disabled: cluego_pathways.page <= 1}" v-on:click="change_cluego_pathways_page(cluego_pathways.page - 1)">&lt;</div>
                  {{ cluego_pathways.page }}
                  <div class="button" v-bind:class="{disabled: cluego_pathways.page >= cluego_pathways_filtered.n_pages}" v-on:click="change_cluego_pathways_page(cluego_pathways.page + 1)">&gt;</div>
                </div>
              </div>
              <div class="box-children-right">
                <div v-on:click="run_with_cluego_subset()" class="button success-button" v-bind:class="{'disabled': !runnable_with_cluego_subset()}">Reanalyze</div>
                <span class="horizontal-sep"></span>
                <div v-on:click="openGeneratedFile()" class="button success-button" >Open results</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <script src="./index.js"></script>
  </body>
</html>
